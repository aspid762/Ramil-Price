# Учет продаж металлопроката

Веб-приложение для учета продаж металлопроката, управления складом и формирования отчетов.

## Установка и запуск

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/yourusername/metal-sales.git
   cd metal-sales
   ```

2. Создайте и активируйте виртуальное окружение:
   ```bash
   python -m venv venv
   source venv/bin/activate  # для Linux/Mac
   venv\Scripts\activate     # для Windows
   ```

3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

4. Настройте переменные окружения:
   ```bash
   cp .env.example .env
   # Отредактируйте файл .env, указав необходимые параметры
   ```

5. Инициализируйте базу данных:
   ```bash
   flask db upgrade
   ```

6. Запустите приложение:
   ```bash
   python app.py
   ```

7. Откройте в браузере http://localhost:5000

## Основные функции

### Прайс-лист
- Управление товарами в прайс-листе
- История изменения цен
- Экспорт и импорт данных в Excel

### Заказчики
- Управление базой заказчиков
- Индивидуальные наценки и стоимость доставки
- Экспорт и импорт данных в Excel

### Заказы
- Создание и управление заказами
- Добавление товаров из прайс-листа или со склада
- Отслеживание статуса заказов
- Экспорт заказов в Excel

### Склад
- Учет товаров на складе
- Отслеживание движения товаров
- Резервирование товаров под заказы
- Экспорт и импорт данных в Excel

### Отчеты
- Формирование различных отчетов
- Экспорт отчетов в Excel

### Аналитика
- Анализ продаж по периодам
- Анализ продаж по категориям товаров
- Анализ заказчиков
- Визуализация данных с помощью графиков

## Управление миграциями базы данных

Для управления изменениями структуры базы данных используется Flask-Migrate.

### Создание новой миграции

После изменения моделей в `models.py` создайте новую миграцию:

```bash
flask db migrate -m "Описание изменений"
```

### Применение миграций

```bash
flask db upgrade
```

## Развертывание на PythonAnywhere

### Первоначальная настройка

1. Создайте аккаунт на PythonAnywhere и создайте новое веб-приложение Flask
2. Клонируйте репозиторий в свою директорию на PythonAnywhere:
   ```bash
   git clone https://github.com/yourusername/metal-sales.git
   ```
3. Создайте виртуальное окружение и установите зависимости:
   ```bash
   mkvirtualenv --python=/usr/bin/python3.10 myenv
   pip install -r requirements.txt
   ```
4. Настройте файл WSGI для запуска приложения

### Обновление приложения

1. Подключитесь к PythonAnywhere через SSH или откройте консоль Bash
2. Перейдите в директорию проекта:
   ```bash
   cd ~/metal-sales
   ```
3. Активируйте виртуальное окружение:
   ```bash
   workon myenv
   ```
4. Получите последние изменения из репозитория:
   ```bash
   git pull
   ```
5. Установите новые зависимости (если есть):
   ```bash
   pip install -r requirements.txt
   ```

### Миграция базы данных на PythonAnywhere

После внесения изменений в модели данных необходимо применить миграции на сервере:

1. Подключитесь к PythonAnywhere через SSH или откройте консоль Bash
2. Перейдите в директорию проекта:
   ```bash
   cd ~/metal-sales
   ```
3. Активируйте виртуальное окружение:
   ```bash
   workon myenv
   ```
4. Установите переменную окружения FLASK_APP:
   ```bash
   export FLASK_APP=app.py
   ```
5. Создайте миграцию (если она еще не создана локально):
   ```bash
   flask db migrate -m "Описание изменений"
   ```
6. Примените миграцию:
   ```bash
   flask db upgrade
   ```
7. Перезапустите веб-приложение через панель управления PythonAnywhere (кнопка "Reload")

### Решение проблем с базой данных

Если возникают проблемы с базой данных, можно пересоздать её:

1. Удалите файл базы данных:
   ```bash
   rm ~/metal-sales/app.db
   ```
2. Создайте новую базу данных и примените все миграции:
   ```bash
   export FLASK_APP=app.py
   flask db upgrade
   ```
3. Перезапустите веб-приложение

## Структура проекта

- `app.py` - основной файл приложения
- `config.py` - конфигурация приложения
- `models.py` - модели данных
- `routes/` - маршруты приложения
- `templates/` - шаблоны страниц
- `static/` - статические файлы (CSS, JavaScript)
- `utils/` - вспомогательные функции
- `migrations/` - файлы миграций базы данных

## Лицензия

MIT


